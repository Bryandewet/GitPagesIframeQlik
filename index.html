<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Qlik JWT Embed</title>

    <script type="text/javascript">
      const webIntegrationId = "rmEl4GyMPGJg5zybO9bpR28nSJZt0FIE";

      // Replace this with your JWT token
      const jwtToken = "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJicnlhbi5kZXdldEBjaW10Lm5sIiwiZW1haWwiOiJicnlhbi5kZXdldEBjaW10Lm5sIiwibmFtZSI6IlN0YXRpYyBVc2VyIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImlzcyI6Imp1dno2cTNid3BtMmVhYy5ldS5xbGlrY2xvdWQuY29tIiwiYXVkIjoicWxpay5hcGkvbG9naW4vand0LXNlc3Npb24iLCJpYXQiOjE3NDY2Mzg5NzQsImV4cCI6MTc0NjYzOTI3NH0.YTHY25j2upXqcaWX4otz4SxlulKCzko2rNDq8JFgcNk5-F6wNOB6_p8iSG91-vTn2fvIrjx3xxLihfY5G2fzK7fpDcvtoOf_4SVps0sVFPxhs_Eveq8QXpJY2P1FBaANDhamgtkFMve-qZnek0NPl_5wzmPS4ULZRHh-B5L_wyqRy8ixceIiJjob9rRRl3oyeekAKzKyEzdGikpMMwygvvHKRSZnvapFjGyrQfvsS9RFU8fcVMxo6huEG2Y928GHqCcTon7NpQIOqHyO9qx683jB0M_zPvwdc-KroD8pMWRmqKTK9J4gtrFg_cBfC-PH4AfJ1sEbQi626UptWTqjtw"; // Place your static JWT token here

      async function isLoggedIn() {
        const response = await fetch("https://cimt.eu.qlikcloud.com/api/v1/users/me", {
          method: 'GET',
          mode: 'cors',
          credentials: 'include',
          headers: {
            'Content-Type': 'application/json',
            'qlik-web-integration-id': webIntegrationId,
          },
        });
        return response.status === 200;
      }

      async function login() {
        const loggedIn = await isLoggedIn();
        if (!loggedIn) {
          if (jwtToken) {
            const returnTo = encodeURIComponent(window.location.href);
            const loginUrl = `https://cimt.eu.qlikcloud.com/login/jwt-session?qlik-web-integration-id=${webIntegrationId}&token=${jwtToken}&returnto=${returnTo}`;
            window.location.href = loginUrl;
          } else {
            console.error("No JWT token provided!");
          }
        }
      }

      login();
    </script>
  </head>

  <body style="height:600px;">
    <iframe
      src="https://cimt.eu.qlikcloud.com/single/?appid=c51381f5-dea9-49ff-9e4f-284dac71757d&sheet=71ec1f03-7259-492f-a393-702b752df303&select=clearall"
      style="border:none; width:100%; height:100%;"
    ></iframe>
  </body>
</html>
